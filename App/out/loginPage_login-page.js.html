<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: loginPage/login-page.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: loginPage/login-page.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** Global variable for authenticated user's JWT token */
var userJWT;

/** Global variable to store currently logged in user */
var loggedInUser;


/**
 * Login
 * @class
 * @classdesc Allows a user to enter username and password, which is authenticated using the database, or create an account.
 */
var loginPage = {

    /**
     * Renders the login page
     */
    initialize: function() {
        this.renderView();
    },

    /** Event handler for "Submit" button */
    bindEvents: function() {
        $('#loginButton').on('click', this.onLogin);
        $('#createAccount').on('click', this.onCreateAccount);
    },

    /** 
     * On "Submit" button push, calls the authentication API. 
     * If successful, gets the authenticated user and goes to home page.
     */
    onLogin: function(e) {
        e.preventDefault();
        
        $.ajax({
            url: API + "api/authenticate",
            data: {
                email: $('#emailBox').val(),
                password: $('#pwBox').val()
            },
            success: function(data) {
                userJWT = data.token;

                // On successful authentication, get the authenticated user
                $.ajax({
                    url: API + "api/user/me",
                    data: {
                        token: userJWT
                    },
                    success: function(data) {
                        console.log(data.firstName + " " + data.lastName + " logged in.");
                        loggedInUser = data;
                    }
                })
                menuPage.initialize(false);
            },
            error: function(error) {
                console.log(error);
                console.log("Failed login attempt. User: " + $('#emailBox').val() + " at " + Date());
                alert("Unrecognized username or password. Please try again.");
            },
            method: "POST",
            dataType: "json"
        })

        // TODO: remove testing stuff
    },

    /**
     * Initializes the create account page
     */
    onCreateAccount: function(e){
        createAccountPage.initialize();
    },

    /**
     * Loads the login page
     */
    renderView: function() {
        $('#view').load("../loginPage/login-page.html", function(){
            loginPage.bindEvents();
        });
    }
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="contactUs.html">contactUs</a></li><li><a href="createAccountPage.html">createAccountPage</a></li><li><a href="loginPage.html">loginPage</a></li><li><a href="menuPage.html">menuPage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#loggedInUser">loggedInUser</a></li><li><a href="global.html#userJWT">userJWT</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Dec 07 2016 10:54:41 GMT-0600 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
